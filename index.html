
<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Preconnect hints MUST be first for maximum effect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>
    <link rel="dns-prefetch" href="//www.google-analytics.com">
    <link rel="dns-prefetch" href="//www.googletagmanager.com">
    
    <!-- Preload LCP hero logo image for immediate discovery -->
    <link rel="preload" as="image" href="/assets/laangar-logo-128.png" fetchpriority="high" type="image/png">
    
    <!-- Primary Meta Tags -->
    <title>ابزارهای آنلاین رایگان فارسی | +۱۰۰ ابزار حرفه‌ای | لنگر</title>
    <meta name="title" content="ابزارهای آنلاین رایگان فارسی | +۱۰۰ ابزار حرفه‌ای | لنگر" />
    <meta name="description" content="بیش از ۱۰۰ ابزار آنلاین رایگان فارسی: محاسبه‌گر، تبدیل متن، ویرایش تصویر، سئو، فال حافظ، تاروت و طالع‌بینی. استفاده فوری بدون ثبت‌نام ✅ سریع، دقیق و امن - لنگر" />
    <meta name="keywords" content="ابزار آنلاین رایگان, محاسبه گر, تبدیل متن فارسی, ویرایش تصویر آنلاین, ابزار سئو, فال حافظ, فال تاروت, طالع بینی, لنگر, بدون ثبت‌نام, ابزار فارسی, فال آنلاین رایگان, استخاره مولانا" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    
    <!-- Author & Publisher -->
    <meta name="author" content="لنگر - Laangar" />
    <meta name="publisher" content="لنگر" />
    <meta name="copyright" content="© 2025 لنگر - تمامی حقوق محفوظ است" />
    
    <!-- Language & Region -->
    <meta name="language" content="Persian" />
    <meta http-equiv="content-language" content="fa-IR" />
    <meta name="geo.region" content="IR" />
    <meta name="geo.country" content="Iran" />
    <meta name="geo.placename" content="ایران" />
    <meta name="target" content="all" />
    <meta name="audience" content="all" />
    <meta name="coverage" content="Worldwide" />
    <meta name="distribution" content="Global" />
    
    <!-- PWA Manifest and Theme -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#eab308" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="لنگر" />
    <meta name="application-name" content="لنگر" />
    <meta name="msapplication-TileColor" content="#eab308" />
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-192x192.png" />
    
    <!-- SEO & Robots -->
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
    <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
    <meta name="bingbot" content="index, follow" />
    <meta name="revisit-after" content="3 days" />
    <meta name="rating" content="general" />
    <link rel="canonical" href="https://laangar.com/" />
    
    <!-- Hreflang for language targeting -->
    <link rel="alternate" hreflang="fa" href="https://laangar.com/" />
    <link rel="alternate" hreflang="fa-IR" href="https://laangar.com/" />
    <link rel="alternate" hreflang="x-default" href="https://laangar.com/" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="لنگر - ابزارهای آنلاین رایگان" />
    <meta property="og:title" content="ابزارهای آنلاین رایگان فارسی | +۱۰۰ ابزار حرفه‌ای | لنگر" />
    <meta property="og:description" content="بیش از ۱۰۰ ابزار آنلاین رایگان: محاسبه‌گر، تبدیل متن، ویرایش تصویر، سئو، فال حافظ و طالع‌بینی. استفاده فوری بدون ثبت‌نام ✅" />
    <meta property="og:url" content="https://laangar.com/" />
    <meta property="og:image" content="https://laangar.com/assets/social-logo.jpg" />
    <meta property="og:image:secure_url" content="https://laangar.com/assets/social-logo.jpg" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="لنگر - ابزارهای آنلاین رایگان فارسی" />
    <meta property="og:locale" content="fa_IR" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@laangar_ir" />
    <meta name="twitter:creator" content="@laangar_ir" />
    <meta name="twitter:title" content="ابزارهای آنلاین رایگان فارسی | +۱۰۰ ابزار حرفه‌ای | لنگر" />
    <meta name="twitter:description" content="بیش از ۱۰۰ ابزار آنلاین رایگان: محاسبه‌گر، تبدیل متن، ویرایش تصویر، سئو، فال حافظ و طالع‌بینی ✅" />
    
    <!-- CSS Preloading Script for non-render-blocking CSS -->
    <script>
      // Function to preload CSS files asynchronously
      function loadCSS(href, before, media) {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = href;
        link.media = media || 'all';
        if (before) {
          before.parentNode.insertBefore(link, before);
        } else {
          document.head.appendChild(link);
        }
        return link;
      }
      
      // Preload CSS with high priority but non-blocking
      function preloadCSS(href, media) {
        const link = document.createElement('link');
        link.rel = 'preload';
        link.as = 'style';
        link.href = href;
        link.onload = function() {
          this.onload = null;
          this.rel = 'stylesheet';
          this.media = media || 'all';
        };
        document.head.appendChild(link);
        
        // Fallback for browsers that don't support preload
        const fallback = document.createElement('noscript');
        const fallbackLink = document.createElement('link');
        fallbackLink.rel = 'stylesheet';
        fallbackLink.href = href;
        fallback.appendChild(fallbackLink);
        document.head.appendChild(fallback);
        
        return link;
      }
      
      // Store function globally for use by Vite
      window.preloadCSS = preloadCSS;
      window.loadCSS = loadCSS;
    </script>
    
    <!-- Preload critical JavaScript modules for faster TTI -->
    <link rel="modulepreload" href="/src/main.tsx" fetchpriority="high">
    
    <!-- Modern Font Loading - Performance Optimized -->
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    
    <!-- Critical Persian font preload for immediate rendering - single font for LCP -->
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn/woff2/Vazirmatn-Regular.woff2" as="font" type="font/woff2" crossorigin fetchpriority="high">
    
    <!-- Modern Google Fonts with variable weights -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&family=Inter:wght@100..900&family=JetBrains+Mono:wght@100..800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- Persian fonts from CDN -->
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn/font-face.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/rastikerdar/shabnam-font@v5.0.1/dist/font-face.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- Critical inline font styles with metric overrides to prevent CLS -->
    <style>
      /* Fallback font adjustments to match web fonts and prevent layout shift */
      @font-face {
        font-family: 'Manrope-fallback';
        src: local('Arial');
        size-adjust: 107%;
        ascent-override: 92%;
        descent-override: 24%;
        line-gap-override: 0%;
      }

      @font-face {
        font-family: 'Inter-fallback';
        src: local('Arial');
        size-adjust: 107%;
        ascent-override: 90%;
        descent-override: 22%;
        line-gap-override: 0%;
      }

      @font-face {
        font-family: 'Vazirmatn-fallback';
        src: local('Tahoma');
        size-adjust: 100%;
        ascent-override: 92%;
        descent-override: 24%;
        line-gap-override: 0%;
      }

      /* Manrope - Modern Display/Heading Font */
      @font-face {
        font-family: 'Manrope';
        font-style: normal;
        font-weight: 200 800;
        font-display: swap;
        src: url('https://fonts.gstatic.com/s/manrope/v15/xn7_YHE41ni1AdIRqAuZuw1Bx9mbZk59FO_F87jxeN7B.woff2') format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }

      /* Inter Variable - Modern Body Font */
      @font-face {
        font-family: 'Inter';
        font-style: normal;
        font-weight: 100 900;
        font-display: swap;
        src: url('https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7.woff2') format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }

      /* JetBrains Mono - Modern Monospace */
      @font-face {
        font-family: 'JetBrains Mono';
        font-style: normal;
        font-weight: 100 800;
        font-display: swap;
        src: url('https://fonts.gstatic.com/s/jetbrainsmono/v18/tDbY_J-oE_sw4OQEeuHKreHPnO6t59dZgWiH_1jQ4dw.woff2') format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }

      /* Vazirmatn - Persian Body Font */
      @font-face {
        font-family: 'Vazirmatn';
        font-style: normal;
        font-weight: 100 900;
        font-display: swap;
        src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn/woff2/Vazirmatn-Regular.woff2') format('woff2');
        unicode-range: U+0600-06FF, U+200C-200E, U+2010-2011, U+204F, U+2E41, U+FB50-FDFF, U+FE80-FEFC, U+0000-00FF, U+0131, U+0152-0153;
      }

      /* Shabnam - Persian Accent Font */
      @font-face {
        font-family: 'Shabnam';
        font-style: normal;
        font-weight: 100 900;
        font-display: swap;
        src: url('https://cdn.jsdelivr.net/gh/rastikerdar/shabnam-font@v5.0.1/dist/woff2/Shabnam-FD.woff2') format('woff2');
        unicode-range: U+0600-06FF, U+200C-200E, U+2010-2011, U+204F, U+2E41, U+FB50-FDFF, U+FE80-FEFC, U+0000-00FF, U+0131, U+0152-0153;
      }
    </style>
    
    <!-- Fallback for browsers that don't support preload -->
    <noscript>
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&family=Inter:wght@100..900&family=JetBrains+Mono:wght@100..800&display=swap">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn/font-face.css">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/shabnam-font@v5.0.1/dist/font-face.css">
    </noscript>
    
    <!-- Critical inline styles for immediate rendering -->
    <style>
      html {
        direction: rtl;
        font-family: 'Dana', 'YekanBakh', 'Vazirmatn', system-ui, -apple-system, 'Segoe UI', Tahoma, Arial, sans-serif;
      }
      body {
        font-family: 'Dana', 'YekanBakh', 'Vazirmatn', system-ui, -apple-system, 'Segoe UI', Tahoma, Arial, sans-serif;
        background-color: #fafaff;
        margin: 0;
        padding: 0;
        line-height: 1.7;
      }
      #root {
        min-height: 100vh;
        contain: layout style;
      }
      
      /* Minimal loading state */
      #root {
        opacity: 1;
        min-height: 100vh;
      }
      
      /* Ensure immediate text visibility */
      body { 
        font-display: swap; 
        visibility: visible;
        opacity: 1;
      }
      
      /* Static content positioned absolutely to prevent layout shift when hidden */
      #static-content {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1;
        background: #fafaff;
        contain: layout style paint;
      }
      
      /* When React mounts, hide static content without layout shift */
      #static-content.hidden {
        visibility: hidden;
        opacity: 0;
        pointer-events: none;
      }
      
      /* Offscreen rendering optimization */
      .cv-auto {
        content-visibility: auto;
        contain-intrinsic-size: 1px 1000px; /* Reserve space to avoid layout shift */
      }
    </style>
    
    <!-- Defer Google Analytics to improve TTI -->
    <script>
      // Defer Google Analytics loading to improve TTI
      window.addEventListener('load', function() {
        setTimeout(function() {
          const script = document.createElement('script');
          script.async = true;
          script.src = 'https://www.googletagmanager.com/gtag/js?id=G-P5JG2WQN86';
          document.head.appendChild(script);
          
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);} 
          gtag('js', new Date());
          gtag('config', 'G-P5JG2WQN86');
        }, 1000); // Delay GA loading by 1 second
      });
    </script>
    <meta name="twitter:image" content="https://storage.googleapis.com/gpt-engineer-file-uploads/EcL48iwIIXRo2Db7e5QiOoiuttN2/social-images/social-1757968623837-76e15b28-6fa7-4dd3-bb57-922abbe9dca7.png">
</head>
  <body>
    <div id="root">
      <!-- SEO-Critical Static Content - Only visible on homepage for crawlers -->
      <!-- This content is immediately hidden by JavaScript on non-homepage routes -->
      <div id="static-content" style="font-family: 'Vazirmatn', Tahoma, sans-serif; direction: rtl; display: none;">
        <!-- Header with navigation - fixed height to prevent CLS -->
        <header style="padding: 1rem 2rem; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; height: 72px; box-sizing: border-box;">
          <a href="/" style="display: flex; align-items: center; gap: 0.75rem; text-decoration: none;">
            <img src="/assets/laangar-logo.png" alt="لنگر" width="48" height="48" style="border-radius: 0.5rem; aspect-ratio: 1/1;">
            <span style="font-size: 1.5rem; font-weight: 700; color: #1f2937;">لنگر</span>
          </a>
          <nav style="display: flex; gap: 1.5rem; align-items: center;">
            <a href="/all-tools" style="color: #4b5563; text-decoration: none;">همه ابزارها</a>
            <span style="color: #4b5563; cursor: default;">دسته‌بندی‌ها ▾</span>
          </nav>
          <!-- Category links for crawlers (hidden visually but accessible) -->
          <div style="display: none;">
            <a href="/calculators">محاسبه‌گرها</a>
            <a href="/text-tools">ابزارهای متنی</a>
            <a href="/image-tools">ابزارهای تصویر</a>
            <a href="/persian-tools">فرهنگ فارسی</a>
            <a href="/readings">فال و طالع‌بینی</a>
            <a href="/seo-tools">سئو و وب</a>
          </div>
        </header>
        
        <!-- Hero Section - uses min-height to reserve space and prevent CLS -->
        <main role="main" style="max-width: 1000px; margin: 0 auto; padding: 2rem; contain: content;">
          <section style="text-align: center; padding: 2.5rem 1rem; background: linear-gradient(to bottom, #fffbeb, #ffffff); border-radius: 1rem; min-height: 180px;">
            <!-- H1 uses system font metrics to prevent font-swap CLS -->
            <h1 style="font-size: 1.75rem; font-weight: 800; color: #1f2937; margin-bottom: 0.75rem; line-height: 1.4; min-height: 2.45em;">
              بیش از <span style="background: linear-gradient(135deg, #eab308, #f59e0b); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">۱۰۰ ابزار آنلاین رایگان فارسی</span> در یک جا
            </h1>
            <p style="font-size: 1rem; color: #6b7280; margin: 0 auto 1.5rem; max-width: 500px; min-height: 1.5em;">برای محاسبات، تبدیل متن، ویرایش تصویر و سئو. بدون ثبت‌نام، سریع و امن</p>
          </section>
          
          <!-- Category Strip - 6 main clusters -->
          <section style="padding: 1.5rem 0;">
            <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.75rem;">
              <a href="/calculators" style="padding: 1rem; background: #fff; border: 1px solid #e5e7eb; border-radius: 0.75rem; text-decoration: none; text-align: center;">
                <div style="font-size: 0.875rem; font-weight: 600; color: #1f2937;">محاسبات</div>
              </a>
              <a href="/text-tools" style="padding: 1rem; background: #fff; border: 1px solid #e5e7eb; border-radius: 0.75rem; text-decoration: none; text-align: center;">
                <div style="font-size: 0.875rem; font-weight: 600; color: #1f2937;">متن</div>
              </a>
              <a href="/image-tools" style="padding: 1rem; background: #fff; border: 1px solid #e5e7eb; border-radius: 0.75rem; text-decoration: none; text-align: center;">
                <div style="font-size: 0.875rem; font-weight: 600; color: #1f2937;">تصویر</div>
              </a>
              <a href="/seo-tools" style="padding: 1rem; background: #fff; border: 1px solid #e5e7eb; border-radius: 0.75rem; text-decoration: none; text-align: center;">
                <div style="font-size: 0.875rem; font-weight: 600; color: #1f2937;">سئو</div>
              </a>
              <a href="/persian-tools" style="padding: 1rem; background: #fff; border: 1px solid #e5e7eb; border-radius: 0.75rem; text-decoration: none; text-align: center;">
                <div style="font-size: 0.875rem; font-weight: 600; color: #1f2937;">فرهنگ فارسی</div>
              </a>
              <a href="/readings" style="padding: 1rem; background: #fff; border: 1px solid #e5e7eb; border-radius: 0.75rem; text-decoration: none; text-align: center;">
                <div style="font-size: 0.875rem; font-weight: 600; color: #1f2937;">فال</div>
              </a>
            </div>
          </section>
          
          <!-- Popular Tools Section - compact -->
          <section style="margin: 2rem 0; padding: 1.5rem; background: #f9fafb; border-radius: 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
              <h2 style="font-size: 1.125rem; font-weight: 600; color: #1f2937; margin: 0;">پرکاربرد</h2>
              <a href="/all-tools" style="font-size: 0.875rem; color: #6b7280; text-decoration: none;">همه ←</a>
            </div>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem;">
              <a href="/tool/bmi-calculator" style="padding: 0.75rem; background: #fff; border: 1px solid #e5e7eb; border-radius: 0.5rem; text-decoration: none; font-size: 0.875rem; color: #1f2937;">محاسبه‌گر BMI</a>
              <a href="/tool/percentage-calculator" style="padding: 0.75rem; background: #fff; border: 1px solid #e5e7eb; border-radius: 0.5rem; text-decoration: none; font-size: 0.875rem; color: #1f2937;">محاسبه‌گر درصد</a>
              <a href="/tool/text-counter" style="padding: 0.75rem; background: #fff; border: 1px solid #e5e7eb; border-radius: 0.5rem; text-decoration: none; font-size: 0.875rem; color: #1f2937;">شمارنده متن</a>
              <a href="/tool/image-compressor" style="padding: 0.75rem; background: #fff; border: 1px solid #e5e7eb; border-radius: 0.5rem; text-decoration: none; font-size: 0.875rem; color: #1f2937;">فشرده‌سازی تصویر</a>
              <a href="/tool/hafez-fortune" style="padding: 0.75rem; background: #fff; border: 1px solid #e5e7eb; border-radius: 0.5rem; text-decoration: none; font-size: 0.875rem; color: #1f2937;">فال حافظ</a>
              <a href="/tool/qr-code-generator" style="padding: 0.75rem; background: #fff; border: 1px solid #e5e7eb; border-radius: 0.5rem; text-decoration: none; font-size: 0.875rem; color: #1f2937;">ساخت QR Code</a>
              <a href="/tool/password-generator" style="padding: 0.75rem; background: #fff; border: 1px solid #e5e7eb; border-radius: 0.5rem; text-decoration: none; font-size: 0.875rem; color: #1f2937;">ساخت رمز عبور</a>
              <a href="/tool/discount-calculator" style="padding: 0.75rem; background: #fff; border: 1px solid #e5e7eb; border-radius: 0.5rem; text-decoration: none; font-size: 0.875rem; color: #1f2937;">محاسبه تخفیف</a>
            </div>
          </section>
        </main>
        
        <!-- Footer -->
        <footer style="background: #f9fafb; padding: 1.5rem; text-align: center; border-top: 1px solid #e5e7eb;">
          <nav style="display: flex; justify-content: center; gap: 1.5rem; flex-wrap: wrap;">
            <a href="/about" style="color: #4b5563; text-decoration: none; font-size: 0.875rem;">درباره ما</a>
            <a href="/all-tools" style="color: #4b5563; text-decoration: none; font-size: 0.875rem;">همه ابزارها</a>
            <a href="/faq" style="color: #4b5563; text-decoration: none; font-size: 0.875rem;">سوالات متداول</a>
            <a href="/privacy-policy" style="color: #4b5563; text-decoration: none; font-size: 0.875rem;">حریم خصوصی</a>
          </nav>
        </footer>
      </div>
      
      <!-- Minimal loading skeleton for non-homepage routes -->
      <div id="loading-skeleton" style="display: none; font-family: 'Vazirmatn', Tahoma, sans-serif; direction: rtl; padding: 2rem; max-width: 1000px; margin: 0 auto;">
        <div style="height: 2rem; width: 60%; background: #f3f4f6; border-radius: 0.5rem; margin-bottom: 1rem;"></div>
        <div style="height: 1rem; width: 80%; background: #f3f4f6; border-radius: 0.5rem; margin-bottom: 2rem;"></div>
        <div style="height: 300px; background: #f9fafb; border-radius: 1rem; border: 1px solid #e5e7eb;"></div>
      </div>
      
      <!-- Script to show appropriate content based on route -->
      <script>
        (function() {
          var path = window.location.pathname;
          var isHomepage = path === '/' || path === '';
          var staticContent = document.getElementById('static-content');
          var loadingSkeleton = document.getElementById('loading-skeleton');
          
          if (isHomepage && staticContent) {
            // Show static homepage content for SEO and fast LCP on homepage
            staticContent.style.display = 'block';
          } else if (loadingSkeleton) {
            // Show minimal loading skeleton on other routes
            loadingSkeleton.style.display = 'block';
          }
        })();
      </script>
      
      <!-- CSS for hiding static content after React mounts -->
      <style>
        #static-content.hidden,
        #loading-skeleton.hidden {
          display: none !important;
        }
      </style>
    </div>
    
    <!-- Load React app directly -->
    <script type="module" src="/src/main.tsx"></script>
    <script>
      // Defer service worker registration to improve TTI
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          setTimeout(() => {
            navigator.serviceWorker.register('/sw.js').catch(() => {});
          }, 3000); // Delay SW registration further
        });
      }
      
      // Immediately visible - remove any blocking
      document.body.style.visibility = 'visible';
      
      // Fast React mount detection using MutationObserver (more efficient than setInterval)
      (function() {
        var staticContent = document.getElementById('static-content');
        var loadingSkeleton = document.getElementById('loading-skeleton');
        var root = document.getElementById('root');
        if (!root) return;
        
        var hidePreRenderContent = function() {
          // Hide static content
          if (staticContent && staticContent.parentNode) {
            staticContent.classList.add('hidden');
            requestAnimationFrame(function() {
              requestAnimationFrame(function() {
                if (staticContent && staticContent.parentNode) {
                  staticContent.parentNode.removeChild(staticContent);
                }
              });
            });
          }
          // Hide loading skeleton
          if (loadingSkeleton && loadingSkeleton.parentNode) {
            loadingSkeleton.classList.add('hidden');
            requestAnimationFrame(function() {
              requestAnimationFrame(function() {
                if (loadingSkeleton && loadingSkeleton.parentNode) {
                  loadingSkeleton.parentNode.removeChild(loadingSkeleton);
                }
              });
            });
          }
        };
        
        // Use MutationObserver for efficient DOM change detection
        var observer = new MutationObserver(function(mutations) {
          // Check if React rendered something besides our pre-render content
          var hasReactContent = Array.from(root.children).some(function(child) {
            return child.id !== 'static-content' && child.id !== 'loading-skeleton';
          });
          if (hasReactContent) {
            observer.disconnect();
            hidePreRenderContent();
          }
        });
        
        observer.observe(root, { childList: true, subtree: false });
        
        // Faster fallback: 2s max wait
        setTimeout(function() {
          observer.disconnect();
          hidePreRenderContent();
        }, 2000);
      })();
      
      // Optimize main thread by yielding control
      function yieldToMain() {
        return new Promise(resolve => {
          setTimeout(resolve, 0);
        });
      }
      
      // Break up long tasks for better TTI
      window.breakUpLongTasks = yieldToMain;
      
      // Improve Speed Index: lazy-load offscreen images and apply content-visibility to offscreen sections
      // Optimized to prevent forced reflows by batching reads before writes
      function optimizeOffscreen() {
        try {
          const vh = window.innerHeight || 800;
          const threshold = vh * 1.2;
          
          // Batch all reads first to prevent forced reflows
          const sections = document.querySelectorAll('main > section, section, article, [data-defer]');
          const sectionData = Array.from(sections).map(el => ({
            el,
            top: el.getBoundingClientRect().top
          }));
          
          const images = Array.from(document.images || []);
          const imageData = images.map(img => ({
            img,
            top: img.getBoundingClientRect().top,
            hasLoading: img.hasAttribute('loading'),
            hasFetchPriority: img.hasAttribute('fetchpriority')
          }));
          
          // Now do all writes without interleaving reads
          // Apply content-visibility to offscreen sections
          sectionData.forEach(({ el, top }) => {
            if (top > threshold) {
              el.classList.add('cv-auto');
            }
          });
          
          // Lazy-load offscreen images and set fetch priorities
          imageData.forEach(({ img, top, hasLoading, hasFetchPriority }) => {
            if (top > threshold) {
              if (!hasLoading) img.setAttribute('loading', 'lazy');
              img.setAttribute('decoding', 'async');
              img.setAttribute('fetchpriority', 'low');
            } else {
              // Prioritize above-the-fold images
              if (!hasFetchPriority) img.setAttribute('fetchpriority', 'high');
            }
          });
        } catch (_) { /* noop */ }
      }
      
      window.addEventListener('load', () => {
        // Use requestAnimationFrame to avoid layout thrashing
        if ('requestAnimationFrame' in window) {
          requestAnimationFrame(optimizeOffscreen);
        } else {
          optimizeOffscreen();
        }
      }, { once: true });
      
      document.addEventListener('DOMContentLoaded', () => {
        if ('requestAnimationFrame' in window) {
          requestAnimationFrame(optimizeOffscreen);
        } else {
          optimizeOffscreen();
        }
      }, { once: true });
      
      window.addEventListener('resize', () => {
        if ('requestIdleCallback' in window) {
          // @ts-ignore
          requestIdleCallback(optimizeOffscreen);
        } else {
          setTimeout(optimizeOffscreen, 200);
        }
      });
    </script>
  </body>
</html>
